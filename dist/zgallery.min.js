!function(t,e){"use strict";function i(t,i){this.title=t,this.wrapper=e.createElement("div"),this.wrapper.classList.add(r.WRAPPER),this.img=new Image,this._oncommit={fn:function(){console.log("committed")},context:this},this._layout=i,this.commit=!1,this.sizeObtained=!1,this.width=this.img.naturalWidth,this.height=this.img.naturalHeight}function a(t){this._loadCache=[],this._commitCursor=0,this._timeout=5e3,this._cache=[],this._cacheCursor=0,this._g=t,this._layout=this.LAYOUT.JIGSAW,this._initialized=!1,this._gutterX=0,this._gutterY=0,this._enableFullScreen=!0,this._modal=null,this._banner=null,this._bannerWin=0,this._loadingFlag=null,this._loading=!1,this._onresize=null,this._ondelete=null,this._jigsaw={clipPath:null,count:0},this._waterfall={minWidth:0,maxWidth:0,colCount:0,cols:null},this._brick={minHeight:0,maxHeight:0,rows:null,hasTail:!1},this._renderModal(),this._renderLoading(),s.addHandler(this._g,"click",s.eventHandlerWrapper(this._show,this,!1))}var s={addHandler:function(t,e,i){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener?t.addEventListener(e,i,!1):t["on"+e]=i},removeHandler:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null},eventHandlerWrapper:function(t,e,i,a){var r=function(h){i&&s.removeHandler(this,a,r),t.call(e,h)};return r},arrayAppend:function(t,e){for(var i=0;i<e.length;i++)t.push(e[i]);return t},arrayClear:function(t){for(;t.length>0;)t.pop()},imageClip:function(t,i,a,s,h,n){var l=i.naturalWidth,o=i.naturalHeight,c='<svg width="0" height="0"><defs><clipPath id="clip-shape-'+h+'" clipPathUnits="objectBoundingBox">',d="</clipPath></defs></svg>";if(o/l>a){if(i.classList.add(r.V_CLIP),!s)var _=l,p=_*a,g=1/3,m='<polygon points="'+g+' 0, 1 0, 1 1, 0 1"/>'}else if(i.classList.add(r.H_CLIP),!s)var p=o,_=p/a,u=.5*_/l,v=_/l+.01,m='<polygon points="'+u+" 0, "+v+" 0, "+v+' 1, 0 1"/>';if(s)return null;var f="."+r.JIGSAW_X+n+" div.wrapper:nth-child("+(h+1)+"){-webkit-clip-path: url('#clip-shape-"+h+"');clip-path: url('#clip-shape-"+h+"');}",L=e.createElement("div"),y=e.createElement("style");return L.innerHTML=c+m+d,y.innerHTML=f,y.type="text/css",e.body.appendChild(L),e.head.appendChild(y),{svg:L,style:y}}},r={MODAL:"z-g-modal",MODAL_BANNER:"z-g-modal-banner",MODAL_BANNER_PREV:"z-g-modal-b-prev",MODAL_BANNER_MID:"z-g-modal-b-mid",MODAL_BANNER_NEXT:"z-g-modal-b-next",MODAL_HIDE:"z-g-modal-hide",MODAL_SHOW:"z-g-modal-show",JIGSAW_G:"z-g-jigsaw",JIGSAW_X:"z-g-jigsaw-",WATERFALL_G:"z-g-waterfall",WATERFALL_COL:"z-g-waterfall-col",BRICK_G:"z-g-brick",BRICK_ROW:"z-g-brick-row",V_CLIP:"v-clip",H_CLIP:"h-clip",WIDTH_FIRST:"w-first",HEIGHT_FIRST:"h-first",ARROW_PREV:"arrow-prev",ARROW_NEXT:"arrow-next",ARROW:"arrow",WRAPPER:"wrapper",WRAPPER_DELETED:"wrapper-deleted",INFO:"info",DEL:"del",LOADING:"loading",LOADING_HIDE:"loading-hide",LOADING_SHOW:"loading-show"},h={jigsaw:{max:6,ratio:.6,ratios:{1:[.6],2:[.9,.9],3:[9/10.5,1,1],4:[.6,.6,.6,.6],5:[.6,1,.8,.6,.6],6:[.6,.6,.6,.6,.6,.6]}}};i.prototype.assemble=function(t){var i=e.createElement("div"),a=e.createElement("a");a.classList.add(r.DEL),i.classList.add(r.INFO),t&&(a.style.left="auto",i.style.left="auto",a.style.right=100/3+"%",i.style.right=100/3+"%");var s=this.title,h=this.img,n=this.wrapper;i.innerHTML="<p>"+s+"</p><p>"+h.naturalWidth+"px "+h.naturalHeight+"px</p>",n.appendChild(h),n.appendChild(i),n.appendChild(a)},i.prototype.doCommit=function(){this.commit=!0;var t=this._oncommit.fn,e=this._oncommit.ctx;t.call(e)},i.prototype.setIncomplete=function(){this.sizeObtained||(this.sizeObtained=!0,this._layout==a.prototype.LAYOUT.BRICK?(this.mask=e.createElement("div"),this.mask.style.backgroundColor="grey",this.mask.style.width="100%",this.mask.style.height="100%",this.wrapper.appendChild(this.mask)):this._layout==a.prototype.LAYOUT.WATERFALL&&(this.wrapper.appendChild(this.img),this.img.style.visibility="hidden",this.wrapper.style.backgroundColor="grey"))},i.prototype.setComplete=function(){this.sizeObtained=!0,this._layout==a.prototype.LAYOUT.BRICK?(this.wrapper.removeChild(this.mask),this.mask=null,delete this.mask,this.wrapper.appendChild(this.img)):this._layout==a.prototype.LAYOUT.WATERFALL?this.img.style.visibility="visible":this._layout==a.prototype.LAYOUT.JIGSAW&&this.wrapper.appendChild(this.img),this.assemble()},i.prototype.setOnCommit=function(t,e){this.img.src&&console.warn("Images already cached in browser may not be committed, invoke .setOnCommit() before .setSrc()"),this._oncommit=t instanceof Function?{fn:t,ctx:e}:this._oncommit},i.prototype.setCacheIndex=function(t){this.img.setAttribute("z-g-index",t)},i.prototype.setLayout=function(t){this._layout=t},i.prototype.setSrc=function(t){this.img.src=t,this.img.complete?(console.log("complete"),this.setIncomplete(),this.setComplete(),this.doCommit()):(this.img.onload=function(t){return function(e){console.log("onload"),e.target.onload=null,t.setIncomplete(),t.setComplete(),t.doCommit()}}(this),this.img.onerror=function(t){return function(e){console.warn("onerror"),e.target.onerror=null,t.doCommit()}}(this))},i.prototype.isSizeObtained=function(){return this.img.naturalWidth!=this.width&&this.img.naturalHeight!=this.height},a.prototype._renderModal=function(){var t=e.createElement("div");t.classList.add(r.MODAL),t.classList.add(r.MODAL_HIDE);var i=e.createElement("div"),a=e.createElement("div"),h=e.createElement("div");i.classList.add(r.ARROW),a.classList.add(r.ARROW),i.classList.add(r.ARROW_PREV),a.classList.add(r.ARROW_NEXT),h.classList.add(r.MODAL_BANNER),t.appendChild(h),t.appendChild(i),t.appendChild(a),e.body.appendChild(t),s.addHandler(h,"click",s.eventHandlerWrapper(this._hide,this,!1)),s.addHandler(i,"click",s.eventHandlerWrapper(this._prev,this,!1)),s.addHandler(a,"click",s.eventHandlerWrapper(this._next,this,!1)),this._modal=t,this._banner=h},a.prototype._renderLoading=function(){var t=e.createElement("div");t.classList.add(r.LOADING),t.innerHTML="LOADING......",e.body.appendChild(t),this._loadingFlag=t},a.prototype._showLoading=function(){this._loading=!0,this._loadingFlag.classList.add(r.LOADING_SHOW)},a.prototype._hideLoading=function(){this._loading=!1,this._loadingFlag.classList.remove(r.LOADING_SHOW)},a.prototype._fetchImage=function(t,e){if(!this._loading){e=e||[];var a=[],s=-1,r=40;this._showLoading();for(var h=0;h<t.length;h++){var n=new i(e[h]||"",this._layout);n.setOnCommit(this._commitImage,this),n.setSrc(t[h]),a.push(n),this._loadCache.push(n)}var l=function(t){var e=0;return function(){e++;for(var i=e*r,h=0;h<a.length;h++){var n=a[h];n.commit?a.splice(h,1):n.isSizeObtained()?(console.log("size obtained"),a.splice(h,1),n.setIncomplete(),n.doCommit()):i>t._timeout&&(console.log("timeout"),a.splice(h,1),n.doCommit())}0==a.length&&(console.log("timer cleared"),clearInterval(s),t._hideLoading())}}(this);s=setInterval(l,r)}},a.prototype._commitImage=function(){for(var t=this._commitCursor;t<this._loadCache.length&&this._loadCache[t].commit;)if(this._loadCache[t].sizeObtained){var e=this._loadCache[t];e.setCacheIndex(this._cache.length),this._cache.push(e),t++}else t++;this._commitCursor=t,this._commitCursor==this._loadCache.length&&(console.log("all committed"),s.arrayClear(this._loadCache),this._commitCursor=0),this._placeImage()},a.prototype._removeImageData=function(t){this._cache[t];t<this._cacheCursor&&this._cacheCursor--,this._cache.splice(t,1);for(var e=t;e<this._cache.length;e++)this._cache[e].img.setAttribute("z-g-index",e)},a.prototype._methodBind=function(t){switch(this._layout){case this.LAYOUT.JIGSAW:this._initJigsaw(t),this._placeImage=this._placeImageJigsaw,this._removeImage=this._removeImageJigsaw,this._resetLayout=this._resetLayoutJigsaw,this._delete=this._deleteJigsaw;break;case this.LAYOUT.WATERFALL:this._initWaterfall(t),this._placeImage=this._placeImageWaterfall,this._removeImage=this._removeImageWaterfall,this._resetLayout=this._resetLayoutWaterfall,this._delete=this._deleteWaterfall;break;case this.LAYOUT.BRICK:this._initBrick(t),this._placeImage=this._placeImageBrick,this._removeImage=this._removeImageBrick,this._resetLayout=this._resetLayoutBrick,this._delete=this._deleteBrick}},a.prototype._placeImage=null,a.prototype._removeImage=null,a.prototype._resetLayout=null,a.prototype._show=function(t){if("IMG"===t.target.nodeName&&this._enableFullScreen){var e=this._layout==this.LAYOUT.JIGSAW?this._jigsaw.count:this._cache.length;this._bannerWin=e;for(var i=t.target.cloneNode(t),a=parseInt(i.getAttribute("z-g-index")),s=-1;s<2;s++){var h=(s<0?a+s+e:a+s)%e,n=this._cache[h].img.cloneNode(!0);n.classList.add(n.naturalWidth>n.naturalHeight?r.WIDTH_FIRST:r.HEIGHT_FIRST),this._banner.appendChild(n)}this._banner.children[0].classList.add(r.MODAL_BANNER_PREV),this._banner.children[1].classList.add(r.MODAL_BANNER_MID),this._banner.children[2].classList.add(r.MODAL_BANNER_NEXT),this._modal.classList.remove(r.MODAL_HIDE),this._modal.classList.add(r.MODAL_SHOW)}},a.prototype._hide=function(t){t.target==this._banner&&(this._banner.innerHTML="",this._modal.classList.remove(r.MODAL_SHOW),this._modal.classList.add(r.MODAL_HIDE))},a.prototype._prev=function(t){var e=this._bannerWin,i=parseInt(this._banner.children[0].getAttribute("z-g-index")),a=(i-1+e)%e;this._banner.children[0].classList.remove(r.MODAL_BANNER_PREV),this._banner.children[1].classList.remove(r.MODAL_BANNER_MID),this._banner.children[1].classList.add(r.MODAL_BANNER_NEXT),this._banner.children[0].classList.add(r.MODAL_BANNER_MID),this._banner.removeChild(this._banner.children[2]);var s=this._cache[a].img.cloneNode(!0);s.classList.add(s.naturalWidth>s.naturalHeight?r.WIDTH_FIRST:r.HEIGHT_FIRST),s.classList.add(r.MODAL_BANNER_PREV),this._banner.insertBefore(s,this._banner.children[0])},a.prototype._next=function(t){var e=this._bannerWin,i=parseInt(this._banner.children[2].getAttribute("z-g-index")),a=(i+1)%e;this._banner.children[2].classList.remove(r.MODAL_BANNER_NEXT),this._banner.children[1].classList.remove(r.MODAL_BANNER_MID),this._banner.children[1].classList.add(r.MODAL_BANNER_PREV),this._banner.children[2].classList.add(r.MODAL_BANNER_MID),this._banner.removeChild(this._banner.children[0]);var s=this._cache[a].img.cloneNode(!0);s.classList.add(s.naturalWidth>s.naturalHeight?r.WIDTH_FIRST:r.HEIGHT_FIRST),s.classList.add(r.MODAL_BANNER_NEXT),this._banner.appendChild(s)},a.prototype._initJigsaw=function(){function e(t){this._g.style.height=this._g.clientWidth*h.jigsaw.ratio+"px"}this._g.classList.add(r.JIGSAW_G),this._jigsaw.clipPath=[],this._jigsaw.count=0,this._g.style.height=this._g.clientWidth*h.jigsaw.ratio+"px",s.addHandler(t,"resize",this._onresize=s.eventHandlerWrapper(e,this,!1))},a.prototype._resetLayoutJigsaw=function(){for(var t=0;t<this._cache.length;t++){var e=this._cache[t].img;this._cache[t].wrapper;e.classList.remove(r.H_CLIP),e.classList.remove(r.V_CLIP)}this._g.innerHTML="",this._g.classList.remove(r.JIGSAW_X+this._jigsaw.count),this._clearClipPath()},a.prototype._clearClipPath=function(){for(var t=0;t<this._jigsaw.clipPath.length;t++){var i=this._jigsaw.clipPath[t];e.head.removeChild(i.style),e.body.removeChild(i.svg),i.style=i.svg=null}s.arrayClear(this._jigsaw.clipPath)},a.prototype._placeImageJigsaw=function(){console.log("oops");var t=this._cache.length;this._resetLayoutJigsaw();var e=h.jigsaw.max<t?h.jigsaw.max:t;this._jigsaw.count=e,this._g.classList.add(r.JIGSAW_X+e);for(var i=0;i<e;i++){var a=this._cache[i].img,n=this._cache[i].wrapper;a.naturalWidth,a.naturalHeight;n.innerHTML="",n.appendChild(a),this._cache[i].assemble(this._layout==this.LAYOUT.JIGSAW&&1==i&&2==e);var l=h.jigsaw.ratios[String(e)][i],o=s.imageClip(n,a,l,!(2==e&&1==i),i,e);o&&this._jigsaw.clipPath.push(o),this._g.appendChild(n)}},a.prototype._removeImageJigsaw=function(t){for(var e=!0,i=0;i<t.length;i++){var a=t[i],s=a.firstChild,r=parseInt(s.getAttribute("z-g-index"));s.nextSibling;r>=0?this._removeImageData(r):e=!1}return this._resetLayoutJigsaw(),this._placeImageJigsaw(),e},a.prototype._deleteJigsaw=function(t){if("A"===t.target.nodeName&&t.target.parentNode){var e=t.target.parentNode;this._removeImage([e])}},a.prototype._initWaterfall=function(e){function i(t){var e=this._g.clientWidth,i=e/this._waterfall.colCount;(i>this._waterfall.maxWidth||i<this._waterfall.minWidth)&&(this._resetLayoutWaterfall(),this._placeImageWaterfall())}this._g.classList.add(r.WATERFALL_G),this._waterfall.minWidth=e&&e.minWidth||250,this._waterfall.maxWidth=e&&e.maxWidth||350,this._cacheCursor=0,this._g.style.minWidth=this._waterfall.minWidth+"px",this._waterfall.cols=null,this._initColsWaterfall(),s.addHandler(t,"resize",this._onresize=s.eventHandlerWrapper(i,this,!1))},a.prototype._initColsWaterfall=function(){if(!this._waterfall.cols){this._waterfall.colCount=Math.ceil(this._g.clientWidth/this._waterfall.minWidth),this._waterfall.cols=[];for(var t=100/this._waterfall.colCount,i=e.createDocumentFragment(),a=0;a<this._waterfall.colCount;a++){var s=e.createElement("div");s.style.width=t+"%",s.classList.add(r.WATERFALL_COL),i.appendChild(s),this._waterfall.cols.push({elem:s,height:0}),a<this._waterfall.colCount-1&&(s.style.paddingRight=this._gutterX+"px")}this._g.appendChild(i)}},a.prototype._resetLayoutWaterfall=function(){for(var t=0;t<this._g.children.length;t++)this._g.children[t].innerHTML="";this._g.innerHTML="",s.arrayClear(this._waterfall.cols),this._waterfall.cols=null,this._initColsWaterfall(),this._cacheCursor=0},a.prototype._placeImageWaterfall=function(){for(;this._cacheCursor<this._cache.length;){var t=this._cache[this._cacheCursor].img,e=this._cache[this._cacheCursor].wrapper;this._cacheCursor++,e.style.marginBottom=this._gutterY+"px";for(var i=0,a=this._waterfall.cols[i],s=a.height,r=0;r<this._waterfall.colCount;r++){var h=this._waterfall.cols[r].height;s>h&&(s=h,i=r,a=this._waterfall.cols[i])}a.height+=t.naturalHeight,a.elem.appendChild(e)}},a.prototype._removeImageWaterfall=function(t){for(var e=!0,i=0;i<t.length;i++){var a=t[i],s=a.parentNode;if(s){s.removeChild(a);var r=a.firstChild,h=parseInt(r.getAttribute("z-g-index"));a.innerHTML="",h>=0?this._removeImageData(h):e=!1}}return e},a.prototype._deleteWaterfall=function(t){function e(){a._removeImage([i]),clearTimeout(s)}if("A"===t.target.nodeName){var i=t.target.parentNode;i.classList.add(r.WRAPPER_DELETED),i.style.margin=0;var a=this,s=setTimeout(e,600)}},a.prototype._initBrick=function(e){function i(t){for(var e=this._g.clientWidth,i=!0,a=0;a<this._g.children.length;a++){i=!1;var s=this._g.children[a],r=e*this._brick.rows[a].ratio;s.style.height=r+"px",(r<this._brick.minHeight||r>this._brick.maxHeight)&&(i=!0)}i&&(this._resetLayoutBrick(),this._placeImageBrick())}this._g.classList.add(r.BRICK_G),this._brick.minHeight=e&&e.minHeight||200,this._brick.maxHeight=e&&e.maxHeight||250,this._cacheCursor=0,this._brick.rows=[],this._brick.hasTail=!1,s.addHandler(t,"resize",this._onresize=s.eventHandlerWrapper(i,this,!1))},a.prototype._resetLayoutBrick=function(){for(var t=0;t<this._g.children.length;t++)this._g.children[t].innerHTML="";this._g.innerHTML="",s.arrayClear(this._brick.rows),this._cacheCursor=0,this._brick.hasTail=!1},a.prototype._placeImageBrick=function(){for(var t=-1;t!=this._cacheCursor&&this._cacheCursor<this._cache.length;){t=this._cacheCursor;var i=this._cache.length,a=this._cacheCursor;this._brick.hasTail&&(this._g.removeChild(this._g.lastChild),this._brick.rows.pop());for(var s=this._brick.minHeight,h=this._g.clientWidth,n=0,l=a,o=!1;l<i;){var c=this._cache[l].img,d=s*c.naturalWidth/c.naturalHeight;if(n+d>h){o=!0;break}l++,n+=d}if(o&&l==a)return this._cacheCursor++,void this._addPlaceholderRow();var _=e.createElement("div");_.classList.add(r.BRICK_ROW);var p=o?h:n,g=s*p/n,m=o?n:h;this._brick.rows.push({ratio:s/m}),_.style.height=g+"px";for(var u=a;u<l;u++){var c=this._cache[u].img,v=this._cache[u].wrapper;o&&this._cacheCursor++;var f=s*c.naturalWidth/c.naturalHeight/m;v.style.width=100*f+"%",v.style.paddingBottom=this._gutterY+"px",u<l-1&&(v.style.paddingRight=this._gutterX+"px"),_.appendChild(v)}this._g.appendChild(_),this._brick.hasTail=!o}},a.prototype._removeImageBrick=function(t){for(var e=!0,i=0;i<t.length;i++){var a=t[i],s=a.parentNode;if(s){s.removeChild(a);var r=a.firstChild,h=parseInt(r.getAttribute("z-g-index"));if(a.innerHTML="",h>=0?this._removeImageData(h):e=!1,0==s.children.length){for(var n=0;n<this._g.children.length&&this._g.children[n]!==s;)n++;n==this._g.children.length-1&&(this._brick.hasTail=!1),this._brick.rows.splice(n,1),this._g.removeChild(s)}}}return e},a.prototype._deleteBrick=function(t){function e(){a._removeImage([i]),clearTimeout(s)}if("A"===t.target.nodeName&&t.target.parentNode){var i=t.target.parentNode;i.classList.add(r.WRAPPER_DELETED),i.style.width=0,i.style.paddingRight=0,1==i.parentNode.children.length&&(i.parentNode.style.height=0);var a=this,s=setTimeout(e,600)}},a.prototype.LAYOUT={JIGSAW:0,WATERFALL:1,BRICK:2},a.prototype.setImage=function(e,i,a){return"string"==typeof e?void this.setImage([e],i,[a]):(this._initialized&&(s.removeHandler(t,"resize",this._onresize),s.removeHandler(this._g,"click",this._ondelete),this._resetLayout(),this._g.classList.remove(r.WATERFALL_G),this._g.classList.remove(r.BRICK_G),this._g.classList.remove(r.JIGSAW_G),this._g.classList.remove(r.JIGSAW_X+this._jigsaw.count),this._g.innerHTML="",this._g.setAttribute("style",""),s.arrayClear(this._cache),this._commitCursor=0,this._cacheCursor=0),this._methodBind(i),s.addHandler(this._g,"click",this._ondelete=s.eventHandlerWrapper(this._delete,this,!1)),this._initialized=!0,void this._fetchImage(e,a&&a[0]||null))},a.prototype.addImage=function(t,e){return this._initialized?"string"==typeof t?void this.addImage([t],[e]):void this._fetchImage(t,e&&e[0]||null):void console.warn("ZGallery has not been initialized yet!")},a.prototype.removeImage=function(t){return this._initialized?t instanceof Array?void this._removeImage(t):void this.removeImage([t]):void console.warn("ZGallery has not been initialized yet!")},a.prototype.setGutter=function(t,e){this._gutterX=t||0,this._gutterY=e||this._gutterX},a.prototype.enableFullScreen=function(){this._enableFullScreen=!0},a.prototype.disableFullScreen=function(){this._enableFullScreen=!1},a.prototype.isFullScreenEnabled=function(){return this._enableFullScreen},a.prototype.setTimeout=function(t){this._timeout=t||5e3},a.prototype.getTimeout=function(){return this._timeout},a.prototype.setLayout=function(t){for(var e in this.LAYOUT)if(this.LAYOUT[e]==t)return void(this._layout=t);this._layout=this.LAYOUT.JIGSAW},a.prototype.getLayout=function(){return this._layout},a.prototype.getImageElements=function(){if(!this._initialized)return void console.warn("ZGallery has not been initialized yet!");for(var t=[],e=0;e<this._cache.length;e++)t.push(this._cache[e].wrapper);return t},"undefined"==typeof t.zGallery&&(t.zGallery=function(t){if(t){var i=e.createElement("div");i.classList.add("z-gallery"),t.appendChild(i)}return new a(i)},t.zGallery.LAYOUT=a.prototype.LAYOUT)}(window,document);